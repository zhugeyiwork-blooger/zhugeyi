<script>
document.querySelectorAll('.highlight').forEach((block) => {
  // 防止重复运行
  if (block.querySelector('.copy-button')) return;

  // 1. 获取并添加语言标签
  const langClass = block.parentElement.className || '';
  const lang = langClass.replace('language-', '').replace('highlight', '').trim() || 'CODE';
  
  const header = document.createElement('div');
  header.className = 'code-header';
  header.innerText = lang;
  block.appendChild(header);

  // 2. 添加复制按钮
  const btn = document.createElement('button');
  btn.className = 'copy-button';
  btn.innerText = 'Copy';
  
  btn.addEventListener('click', () => {
    const codeText = block.querySelector('code').innerText;
    navigator.clipboard.writeText(codeText).then(() => {
      btn.innerText = 'Copied!';
      setTimeout(() => { btn.innerText = 'Copy'; }, 2000);
    });
  });
  
  block.appendChild(btn);
});
</script>
